@model PilotSmithApp.UserInterface.Models.ProductionOrderViewModel
<div id="divProductionOrderEmailcontainer">
    <div style="max-width: 1100px; font-size: 16px; line-height: 24px; font-family: 'Helvetica Neue', 'Helvetica', Helvetica, Arial, sans-serif; color: #555; margin: auto; padding: 30px; border: 3px solid #adadad;">
        <table cellpadding="0" cellspacing="0" style="width: 100%; line-height: inherit; text-align: left;border-bottom-color:#4a7f4d!important;border-bottom:thin solid">
            <tr class="top">
                <td style="width:400px;vertical-align: top;  " valign="top"><img src="@ViewBag.path" style="width:100px!important;workAround:image"></td>
                <td colspan="2" style="vertical-align: top;  text-align:right" valign="top">
                    <table style="width: 100%; line-height: inherit; text-align: left;">
                        <tr><td style="text-align:right;"><span style="font-size:25px">ProductionOrder</span></td></tr>
                    </table>
                </td>
            </tr>
        </table>

        <table style="width:100%;line-height:20px;margin-top:5px">
            <tr style="width:100%;">
                <td style="width:70%;"></td>
                <td style="width:30%;text-align:right">
                    <table style="width:100%;font-size:12px">
                        <tr style="width:100%"><td style="text-align:left;">Number  </td><td>:</td><td style="text-align:right;padding-left:5px">@Model.ProdOrderNo</td></tr>
                        <tr style="width:100%"><td style="text-align:left;">Date   </td><td>:</td><td style="text-align:right;padding-left:5px">@Model.ProdOrderDateFormatted </td></tr>
                    </table>
                    <span style="text-align:left;"></span><br />
                    <span style="text-align:left;"></span>
                </td>

            </tr>
        </table>
        <br />
        @{ decimal curProducedQty = 0, amount = 0; string totMilestone;}
        <table>
            <tr style="width:100%;">
                <td><b>From</b></td>
                <td></td>
                @*<td><b>To</b></td>*@
            </tr>
            <tr style="width:100%;">
                <td style="width:400px;text-align:left;font-size:14px;vertical-align:top;">
                    @*Pilotsmith India Pvt. Ltd.<br />
                    Kallettumkara, Trichur Dist,<br />
                    Kerala, India 680 683<br />*@
                    @Html.Raw(@Model.MailFrom)
                </td>
                <td style="width:200px;"></td>
                @*<td style="width:400px;text-align:left;font-size:14px;vertical-align:top;">

                    @Model.Customer.CompanyName<br />
                   
                </td>*@
            </tr>

        </table>


        <br />

        <table>
            <tr>
                <td style="font-size:15px"><b>Sub :</b> ProductionOrder</td>
            </tr>
        </table>

        <br />
      
        <br />
        <table id="ItemDetailsTable" style="font-family: arial, sans-serif; border-collapse: collapse; width: 100%; line-height: 14px; text-align: left;" cellspacing="0" width="100%">
            <thead>
                <tr style="border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #eee;">
                    <th style="width:3%;text-align: center;padding: 8px;font-size:10px; ">No.</th>
                    <th style="width:25%; text-align: left;padding: 8px;font-size:10px;">Product</th>
                    <th style="width:12%; text-align: left;padding: 8px;font-size:10px;">Sale.Ord Qty</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">PrevProd Ord.Qty</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">CurProducedQty</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">Produced.Qty</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">Rate</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">Amount</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">Sup/Plant</th>
                    <th style="width:10%; text-align: right;padding: 8px;font-size:10px;">Completed</th>
                </tr>
                @if (Model.ProductionOrderDetailList != null)
                {
                    int slno = 1;

                    foreach (var mp in Model.ProductionOrderDetailList)
                    {

                        curProducedQty = Math.Round((decimal)mp.OrderQty - (decimal)mp.PrevProducedQty);
                        amount = Math.Round((decimal)mp.OrderQty * (decimal)mp.Rate);

                         totMilestone = "";
                        if ((mp.MileStone1FcFinishDtFormatted != "") && (mp.MileStone1AcTFinishDtFormatted != ""))
                        {
                            totMilestone = "25%";
                        }
                        if ((mp.MileStone2FcFinishDtFormatted != "") && (mp.MileStone2AcTFinishDtFormatted != ""))
                        {
                            totMilestone = "50%";
                        }
                        if ((mp.MileStone3FcFinishDtFormatted != "") && (mp.MileStone3AcTFinishDtFormatted != ""))
                        {
                            totMilestone = "75%";
                        }
                        if ((mp.MileStone4FcFinishDtFormatted != "") && (mp.MileStone4AcTFinishDtFormatted != ""))
                        {
                            totMilestone = "100%";
                        }
                        
                        <tr style="text-align: right;padding: 8px;border-bottom-style: solid;border-bottom-width: 2px;border-bottom-color: #eee;">

                            <td style="width:3%;text-align: center;padding: 8px;font-size:10px;vertical-align:top;">@slno</td>
                            <td style="width:25%; text-align: left;padding: 8px;font-size:10px;vertical-align:top;">@mp.Product.Name - @mp.ProductModel.Name<br />@mp.ProductSpec</td>
                            <td style="width:12%; text-align: left;padding: 8px;font-size:10px;vertical-align:top;">@mp.OrderQty @mp.Unit.Description</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@mp.PrevProducedQty @mp.Unit.Description</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@curProducedQty @mp.Unit.Description</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@mp.ProducedQty @mp.Unit.Description</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@mp.Rate</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@amount</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@mp.Plant.Description</td>
                            <td style="width:10%; text-align: right;padding: 8px;font-size:10px;vertical-align:top;">@totMilestone</td>
                        </tr>
                        slno = slno + 1;
                        
                    }
                   
                }

            </thead>
        </table>
        <br />       
    </div>


</div>
<div class="modal-footer d-flex justify-content-center">
    @if (Model.EmailFlag)
    {
        using (Ajax.BeginForm("UpdateProductionOrderEmailInfo", "ProductionOrder", null, new AjaxOptions { HttpMethod = "POST", Confirm = "", OnSuccess = "SaveSuccessUpdateProductionOrderEmailInfo", OnFailure = "", AllowCache = false, LoadingElementId = "", OnBegin = "OnMasterBegin", OnComplete = "OnMasterComplete" }, new { @class = "", role = "form", id = "FormUpdateProductionOrderEmailInfo" }))
        {
            @Html.EditorFor(model => model.EmailSentTo, new { htmlAttributes = new { @class = "form-control newinput", @placeholder = "Email Sent To" } })
            @Html.HiddenFor(model => model.ID, htmlAttributes: new { @class = "" })          
            <button type="submit" class="btn btn-default" style="margin-top:2%" onclick="UpdateProductionOrderEmailInfo()">Next <i class="fa fa-spinner fa-spin" id="icnMasterLoading" style="display:none;"></i></button>
        }
    }
    else
    {
        using (Ajax.BeginForm("SendProductionOrderEmail", "ProductionOrder", null, new AjaxOptions { HttpMethod = "POST", Confirm = "", OnSuccess = "SaveSuccessProductionOrderEmailSend", OnFailure = "", AllowCache = false, LoadingElementId = "", OnBegin = "OnMasterBegin", OnComplete = "OnMasterComplete" }, new { @class = "", role = "form", id = "FormProductionOrderEmailSend" }))
        {
            @Html.HiddenFor(model => model.ID, htmlAttributes: new { @class = "" })
            @Html.EditorFor(model => model.EmailSentTo, new { htmlAttributes = new { @class = "form-control newinput", @placeholder = "Email Sent To" } })
            @Html.HiddenFor(model => model.MailContant, htmlAttributes: new { @class = "", @id = "hdnProductionOrderEMailContent" })
            <a class="btn btn-default" style="margin-top:2%" onclick="EmailProductionOrder()">Back </a>
            <button type="submit" class="btn btn-default" style="margin-top:2%" onclick="SendProductionOrderEmail()">Send <i class="fa fa-spinner fa-spin" id="icnMasterLoading" style="display:none;"></i></button>

        }

        using (Html.BeginForm("Download", "PDFGenerator", FormMethod.Post, new { @class = "", @style = "position:fixed;bottom:1.6%;right:17%;", role = "form", @id = "PDFForm" }))
        {
            @Html.HiddenFor(model => model.PDFTools.Content, htmlAttributes: new { @class = "", Value = "", @id = "hdnContent" })
            @Html.HiddenFor(model => model.PDFTools.Headcontent, htmlAttributes: new { @class = "", Value = "", @id = "hdnHeadContent" })
            @Html.HiddenFor(model => model.PDFTools.HeaderText, htmlAttributes: new { @class = "", Value = "PilotSmith" })
            @Html.HiddenFor(model => model.PDFTools.ContentFileName, htmlAttributes: new { @class = "", Value = "ProductionOrder", @id = "hdnContentFileName" })
            @Html.HiddenFor(model => model.PDFTools.CustomerName, htmlAttributes: new { @class = "", @id = "hdnCustomerName" })

            <button type="submit" class="btn btn-default" style="margin-top:2%" onclick="DownloadProductionOrder()">Download <i class="fa fa-spinner fa-spin" id="icnMasterLoading" style="display:none;"></i></button>

        }
    }

</div>
<script>
    $(document).ready(function () {
        $.validator.unobtrusive.parse('#FormUpdateProductionOrderEmailInfo');
        $.validator.unobtrusive.parse("#FormProductionOrderEmailSend");
        $.validator.unobtrusive.parse("#FormProductionOrderEmailDownload");
    });
</script>
